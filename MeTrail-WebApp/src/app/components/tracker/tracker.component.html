<div class="content" id="content">
  <h2>Monitoring pracowników</h2>

  <div class="forms">
    <div>
      <mat-form-field appearance="fill" class="form-field">
        <mat-label>Pracownik</mat-label>
        <mat-select (selectionChange)="onEmployeeChange($event.value)">
          <mat-option *ngFor="let employee of employees" [value]="employee">
            {{ employee.fullName }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div>
      <mat-form-field appearance="fill" class="form-field">
        <mat-label>Data</mat-label>
        <input
          matInput
          [matDatepicker]="picker"
          (dateChange)="onDateChange($event.value)"
        />
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
    </div>
  </div>

  <div class="tracker-container">
    <agm-map
      [zoom]="13"
      [latitude]="initialLatitude"
      [longitude]="initialLongitude"
      *ngIf="!loaded"
    >
    </agm-map>

    <agm-map
      [zoom]="13"
      [latitude]="points[0].latitude"
      [longitude]="points[0].longitude"
      *ngIf="loaded"
    >
      <agm-marker
        *ngFor="let point of points; index as i"
        [latitude]="point.latitude"
        [longitude]="point.longitude"
        [iconUrl]="getIconUrl(i)"
        (mouseOver)="onMouseOver(infoWindow)"
        (mouseOut)="onMouseOut(infoWindow)"
      >
        <agm-info-window [disableAutoPan]="false" #infoWindow>
          <p>Data: {{ point.date }}</p>
          <p>Czas: {{ point.time }}</p>
          <p>Dł. geograficzna: {{ point.longitude }}</p>
          <p>Szer. geograficzna: {{ point.latitude }}</p>
          <p>Prędkość: {{ point.speed }}</p>
        </agm-info-window>
      </agm-marker>

      <agm-polyline
        [visible]="true"
        [strokeWeight]="3"
        [strokeColor]="'#07b57a'"
      >
        <agm-polyline-point
          *ngFor="let point of points"
          [latitude]="point.latitude"
          [longitude]="point.longitude"
        >
        </agm-polyline-point>
      </agm-polyline>
    </agm-map>

    <div class="tracker-info">
      <mat-expansion-panel *ngIf="loaded">
        <mat-expansion-panel-header>
          <h3>Statystyki</h3>
        </mat-expansion-panel-header>
        <p><b>Pracownik:</b> {{ chosenEmployee?.fullName }}</p>
        <p><b>Email pracownika:</b> {{ chosenEmployee?.email }}</p>
        <p><b>Data:</b> {{ chosenDate }}</p>
        <p>
          <b>Współczynnik efektywności jazdy:</b>
          {{ chosenEmployee?.drivingEfficiencyFactor }}
        </p>
        <p><b>Przebyty dystans:</b> {{employeeStats?.traveledDistance}} km</p>
        <p><b>Czas rozpoczęcia pracy:</b> {{employeeStats?.startWorkTime}} </p>
        <p><b>Czas zakończenia pracy:</b> {{employeeStats?.endWorkTime}} </p>
        <p><b>Czas pracy:</b> {{employeeStats?.workTimeInHours}} h</p>
      </mat-expansion-panel>
    </div>
  </div>
</div>
